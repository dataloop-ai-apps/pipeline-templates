{
  "name": "rag-preprocessing-template",
  "version": "1.0.103",
  "attributes": {
    "Category": "Pipeline",
    "Pipeline Type": "Data Engineering",
    "Provider": "Dataloop",
    "Media Type": [
      "Text",
      "Document"
    ]
  },
  "displayName": "RAG Preprocessing Template",
  "description": "Automate the process of preprocessing source files (Word docs and PDFs) using multimodal document-to-chunks processors with OCR, recursive chunking, and embedding using an Embedder from Marketplace.",
  "scope": "public",
  "codebase": {
    "type": "git",
    "gitUrl": "https://github.com/dataloop-ai-apps/pipeline-templates.git",
    "gitTag": "1.0.103"
  },
  "components": {
    "pipelineTemplates": [
      {
        "nodes": [
          {
            "id": "0eca6a9c-8c79-4b0f-b150-0daf8a050e89",
            "inputs": [
              {
                "portId": "cd0a8dbb-6391-424b-87d0-e63ae7e5428d",
                "nodeId": "cd0a8dbb-6391-424b-87d0-e63ae7e5428d",
                "type": "Item",
                "name": "item",
                "displayName": "item",
                "io": "input"
              }
            ],
            "outputs": [
              {
                "portId": "701e13dc-66d7-4e8a-9132-1887b3d4d445",
                "nodeId": "701e13dc-66d7-4e8a-9132-1887b3d4d445",
                "type": "Item",
                "name": "item",
                "displayName": "item",
                "io": "output"
              }
            ],
            "name": "Source Dataset",
            "type": "storage",
            "namespace": {
              "functionName": "clone_item",
              "projectName": "DataloopTasks",
              "serviceName": "pipeline-utils",
              "moduleName": "default_module",
              "packageName": "pipeline-utils"
            },
            "metadata": {
              "position": {
                "x": 10000,
                "y": 10100,
                "z": 0
              },
              "componentGroupName": "data",
              "repeatable": true
            }
          },
          {
            "id": "a1b2c3d4-1111-4e78-9012-pdf000000001",
            "inputs": [
              {
                "portId": "a1b2c3d4-2222-4e78-9012-pdf000000001",
                "nodeId": "a1b2c3d4-2222-4e78-9012-pdf000000001",
                "type": "Item",
                "name": "item",
                "displayName": "item",
                "io": "input"
              },
              {
                "portId": "a1b2c3d4-3333-4e78-9012-pdf000000001",
                "nodeId": "a1b2c3d4-3333-4e78-9012-pdf000000001",
                "type": "Dataset",
                "name": "target_dataset",
                "displayName": "target_dataset",
                "io": "input",
                "variableName": "chunks-dataset"
              }
            ],
            "outputs": [
              {
                "portId": "a1b2c3d4-4444-4e78-9012-pdf000000001",
                "nodeId": "a1b2c3d4-4444-4e78-9012-pdf000000001",
                "type": "Item[]",
                "name": "items",
                "displayName": "items",
                "io": "output"
              }
            ],
            "name": "PDF to Chunks",
            "type": "custom",
            "namespace": {
              "functionName": "run",
              "serviceName": "pdf-processor-service",
              "moduleName": "pdf-processor-module",
              "packageName": "rag-pdf-processor"
            },
            "appName": "RAG PDF Processor",
            "dpkName": "rag-pdf-processor",
            "metadata": {
              "position": {
                "x": 10400,
                "y": 10000,
                "z": 0
              },
              "componentGroupName": "document-processing",
              "customNodeConfig": {
                "name": "PDF-to-Chunks",
                "to_correct_spelling": false,
                "ocr_from_images": false,
                "ocr_integration_method": "append_to_page",
                "use_markdown_extraction": false,
                "chunking_strategy": "recursive",
                "max_chunk_size": 300,
                "chunk_overlap": 40,
                "validation": {
                  "valid": true,
                  "errors": []
                }
              },
              "repeatable": true,
              "pipelineNodeName": "pdf-processor-node",
              "variableDataset": "chunks-dataset"
            }
          },
          {
            "id": "a1b2c3d4-1111-4e78-9012-doc000000001",
            "inputs": [
              {
                "portId": "a1b2c3d4-2222-4e78-9012-doc000000001",
                "nodeId": "a1b2c3d4-2222-4e78-9012-doc000000001",
                "type": "Item",
                "name": "item",
                "displayName": "item",
                "io": "input"
              },
              {
                "portId": "a1b2c3d4-3333-4e78-9012-doc000000001",
                "nodeId": "a1b2c3d4-3333-4e78-9012-doc000000001",
                "type": "Dataset",
                "name": "target_dataset",
                "displayName": "target_dataset",
                "io": "input",
                "variableName": "chunks-dataset"
              }
            ],
            "outputs": [
              {
                "portId": "a1b2c3d4-4444-4e78-9012-doc000000001",
                "nodeId": "a1b2c3d4-4444-4e78-9012-doc000000001",
                "type": "Item[]",
                "name": "items",
                "displayName": "items",
                "io": "output"
              }
            ],
            "name": "DOC to Chunks",
            "type": "custom",
            "namespace": {
              "functionName": "run",
              "serviceName": "doc-processor-service",
              "moduleName": "doc-processor-module",
              "packageName": "rag-doc-processor"
            },
            "appName": "RAG DOC Processor",
            "dpkName": "rag-doc-processor",
            "metadata": {
              "position": {
                "x": 10400,
                "y": 10200,
                "z": 0
              },
              "componentGroupName": "document-processing",
              "customNodeConfig": {
                "name": "DOC-to-Chunks",
                "to_correct_spelling": false,
                "ocr_from_images": false,
                "ocr_integration_method": "append_to_page",
                "use_markdown_extraction": false,
                "chunking_strategy": "recursive",
                "max_chunk_size": 300,
                "chunk_overlap": 40,
                "validation": {
                  "valid": true,
                  "errors": []
                }
              },
              "repeatable": true,
              "pipelineNodeName": "doc-processor-node",
              "variableDataset": "chunks-dataset"
            }
          },
          {
            "id": "f0012aad-043a-4965-9410-f2f3afe17ed8",
            "inputs": [
              {
                "portId": "ee35e48d-42fc-42ea-9221-bb26c117a6c1",
                "nodeId": "ee35e48d-42fc-42ea-9221-bb26c117a6c1",
                "type": "Item",
                "name": "item",
                "displayName": "item",
                "io": "input"
              }
            ],
            "outputs": [
              {
                "portId": "c96d2317-bd55-4c14-a656-aca10ef19f5e",
                "nodeId": "c96d2317-bd55-4c14-a656-aca10ef19f5e",
                "type": "Item",
                "name": "item",
                "displayName": "item",
                "io": "output"
              }
            ],
            "name": "Chunks Dataset",
            "type": "storage",
            "namespace": {
              "functionName": "clone_item",
              "projectName": "DataloopTasks",
              "serviceName": "pipeline-utils",
              "moduleName": "default_module",
              "packageName": "pipeline-utils"
            },
            "metadata": {
              "position": {
                "x": 10800,
                "y": 10100,
                "z": 0
              },
              "componentGroupName": "data",
              "repeatable": true,
              "variableDataset": "chunks-dataset"
            }
          },
          {
            "id": "eda69eb4-2c57-46c2-bfb2-ba4ce9663df7",
            "inputs": [
              {
                "portId": "bb5f3fc5-44b7-4271-ac5e-009fc815c682",
                "nodeId": "bb5f3fc5-44b7-4271-ac5e-009fc815c682",
                "type": "Item",
                "name": "item",
                "displayName": "item",
                "io": "input"
              }
            ],
            "outputs": [
              {
                "portId": "64ecb008-4f26-4bc1-a19e-ff09c0e3ad45",
                "nodeId": "64ecb008-4f26-4bc1-a19e-ff09c0e3ad45",
                "type": "Item",
                "name": "item",
                "displayName": "item",
                "io": "output"
              },
              {
                "portId": "bd7b59e9-b0db-479b-9e2e-7b664e156b36",
                "nodeId": "bd7b59e9-b0db-479b-9e2e-7b664e156b36",
                "type": "Json",
                "name": "json",
                "displayName": "json",
                "io": "output"
              }
            ],
            "name": "Embeddings",
            "type": "ml",
            "namespace": {
              "functionName": "embed",
              "serviceName": "model-mgmt-app-embeddings",
              "moduleName": "model-mgmt-app-embeddings",
              "packageName": "model-mgmt-app"
            },
            "metadata": {
              "position": {
                "x": 11200,
                "y": 10100,
                "z": 0
              },
              "modelConfig": {},
              "componentGroupName": "models",
              "repeatable": true,
              "mlType": "embeddings"
            }
          }
        ],
        "connections": [
          {
            "src": {
              "nodeId": "0eca6a9c-8c79-4b0f-b150-0daf8a050e89",
              "portId": "701e13dc-66d7-4e8a-9132-1887b3d4d445"
            },
            "tgt": {
              "nodeId": "a1b2c3d4-1111-4e78-9012-pdf000000001",
              "portId": "a1b2c3d4-2222-4e78-9012-pdf000000001"
            },
            "condition": "{\"metadata.system.mimetype\":\"application/pdf\"}"
          },
          {
            "src": {
              "nodeId": "0eca6a9c-8c79-4b0f-b150-0daf8a050e89",
              "portId": "701e13dc-66d7-4e8a-9132-1887b3d4d445"
            },
            "tgt": {
              "nodeId": "a1b2c3d4-1111-4e78-9012-doc000000001",
              "portId": "a1b2c3d4-2222-4e78-9012-doc000000001"
            },
            "condition": "{\"metadata.system.mimetype\":\"application/vnd.openxmlformats-officedocument.wordprocessingml.document\"}"
          },
          {
            "src": {
              "nodeId": "a1b2c3d4-1111-4e78-9012-pdf000000001",
              "portId": "a1b2c3d4-4444-4e78-9012-pdf000000001"
            },
            "tgt": {
              "nodeId": "f0012aad-043a-4965-9410-f2f3afe17ed8",
              "portId": "ee35e48d-42fc-42ea-9221-bb26c117a6c1"
            },
            "condition": "{}"
          },
          {
            "src": {
              "nodeId": "a1b2c3d4-1111-4e78-9012-doc000000001",
              "portId": "a1b2c3d4-4444-4e78-9012-doc000000001"
            },
            "tgt": {
              "nodeId": "f0012aad-043a-4965-9410-f2f3afe17ed8",
              "portId": "ee35e48d-42fc-42ea-9221-bb26c117a6c1"
            },
            "condition": "{}"
          },
          {
            "src": {
              "nodeId": "f0012aad-043a-4965-9410-f2f3afe17ed8",
              "portId": "c96d2317-bd55-4c14-a656-aca10ef19f5e"
            },
            "tgt": {
              "nodeId": "eda69eb4-2c57-46c2-bfb2-ba4ce9663df7",
              "portId": "bb5f3fc5-44b7-4271-ac5e-009fc815c682"
            },
            "condition": "{}"
          }
        ],
        "startNodes": [
          {
            "nodeId": "0eca6a9c-8c79-4b0f-b150-0daf8a050e89",
            "type": "root",
            "id": "e299b319-7e23-4387-807e-284299395ad4"
          }
        ],
        "name": "RAG Preprocessing Template",
        "description": "Automate the process of preprocessing source files (Word docs and PDFs) using multimodal document-to-chunks processors with OCR, recursive chunking, and embedding using an Embedder from Marketplace.",
        "preview": "",
        "variables": [
          {
            "name": "chunks-dataset",
            "type": "Dataset",
            "description": "Dataset where text chunks will be stored. Used by both the document-to-chunks processors and the intermediate storage node."
          }
        ]
      }
    ]
  },
  "dependencies": [
    {
      "name": "rag-pdf-processor"
    },
    {
      "name": "rag-doc-processor"
    }
  ]
}
