{
  "name": "rag-contextual-preprocessing",
  "version": "1.0.102",
  "attributes": {
    "Category": "Pipeline",
    "Pipeline Type": "Data Engineering",
    "Provider": "Dataloop",
    "Media Type": [
      "Text",
      "Document"
    ]
  },
  "displayName": "RAG Contextual Preprocessing",
  "description": "Automate the process of preprocessing source files (Word docs and PDFs) using multimodal document-to-chunks processors with OCR, recursive chunking, contextual enrichment via LLM, and embedding using an Embedder from Marketplace.",
  "scope": "public",
  "codebase": {
    "type": "git",
    "gitUrl": "https://github.com/dataloop-ai-apps/pipeline-templates.git",
    "gitTag": "1.0.102"
  },
  "components": {
    "pipelineTemplates": [
      {
        "nodes": [
          {
            "id": "a8ce4ea4-325d-4df9-aed9-86b91b672126",
            "inputs": [
              {
                "portId": "7163ce3a-8c2b-424a-b560-63e7e0e57e6a",
                "nodeId": "7163ce3a-8c2b-424a-b560-63e7e0e57e6a",
                "type": "Item",
                "name": "item",
                "displayName": "item",
                "io": "input"
              }
            ],
            "outputs": [
              {
                "portId": "1a36ac84-8c3b-4c50-96bc-80f11ece6475",
                "nodeId": "1a36ac84-8c3b-4c50-96bc-80f11ece6475",
                "type": "Item",
                "name": "item",
                "displayName": "item",
                "io": "output"
              }
            ],
            "name": "Source Dataset",
            "type": "storage",
            "namespace": {
              "functionName": "clone_item",
              "projectName": "DataloopTasks",
              "serviceName": "pipeline-utils",
              "moduleName": "default_module",
              "packageName": "pipeline-utils"
            },
            "metadata": {
              "position": {
                "x": 10000,
                "y": 10100,
                "z": 0
              },
              "componentGroupName": "data",
              "repeatable": true
            }
          },
          {
            "id": "b1c2d3e4-1111-4e78-9012-pdf000000002",
            "inputs": [
              {
                "portId": "b1c2d3e4-2222-4e78-9012-pdf000000002",
                "nodeId": "b1c2d3e4-2222-4e78-9012-pdf000000002",
                "type": "Item",
                "name": "item",
                "displayName": "item",
                "io": "input"
              },
              {
                "portId": "b1c2d3e4-3333-4e78-9012-pdf000000002",
                "nodeId": "b1c2d3e4-3333-4e78-9012-pdf000000002",
                "type": "Dataset",
                "name": "target_dataset",
                "displayName": "target_dataset",
                "io": "input",
                "value": "$var(chunks-dataset)"
              }
            ],
            "outputs": [
              {
                "portId": "b1c2d3e4-4444-4e78-9012-pdf000000002",
                "nodeId": "b1c2d3e4-4444-4e78-9012-pdf000000002",
                "type": "Item[]",
                "name": "items",
                "displayName": "items",
                "io": "output"
              }
            ],
            "name": "PDF to Chunks",
            "type": "custom",
            "namespace": {
              "functionName": "run",
              "serviceName": "pdf-processor-service",
              "moduleName": "pdf-processor-module",
              "packageName": "rag-pdf-processor"
            },
            "appName": "RAG PDF Processor",
            "dpkName": "rag-pdf-processor",
            "metadata": {
              "position": {
                "x": 10400,
                "y": 10000,
                "z": 0
              },
              "componentGroupName": "document-processing",
              "customNodeConfig": {
                "name": "PDF-to-Chunks",
                "to_correct_spelling": false,
                "ocr_from_images": false,
                "ocr_integration_method": "append_to_page",
                "use_markdown_extraction": false,
                "chunking_strategy": "recursive",
                "max_chunk_size": 300,
                "chunk_overlap": 40,
                "validation": {
                  "valid": true,
                  "errors": []
                }
              },
              "repeatable": true,
              "pipelineNodeName": "pdf-processor-node",
              "variableDataset": "chunks-dataset"
            }
          },
          {
            "id": "b1c2d3e4-1111-4e78-9012-doc000000002",
            "inputs": [
              {
                "portId": "b1c2d3e4-2222-4e78-9012-doc000000002",
                "nodeId": "b1c2d3e4-2222-4e78-9012-doc000000002",
                "type": "Item",
                "name": "item",
                "displayName": "item",
                "io": "input"
              },
              {
                "portId": "b1c2d3e4-3333-4e78-9012-doc000000002",
                "nodeId": "b1c2d3e4-3333-4e78-9012-doc000000002",
                "type": "Dataset",
                "name": "target_dataset",
                "displayName": "target_dataset",
                "io": "input",
                "value": "$var(chunks-dataset)"
              }
            ],
            "outputs": [
              {
                "portId": "b1c2d3e4-4444-4e78-9012-doc000000002",
                "nodeId": "b1c2d3e4-4444-4e78-9012-doc000000002",
                "type": "Item[]",
                "name": "items",
                "displayName": "items",
                "io": "output"
              }
            ],
            "name": "DOC to Chunks",
            "type": "custom",
            "namespace": {
              "functionName": "run",
              "serviceName": "doc-processor-service",
              "moduleName": "doc-processor-module",
              "packageName": "rag-doc-processor"
            },
            "appName": "RAG DOC Processor",
            "dpkName": "rag-doc-processor",
            "metadata": {
              "position": {
                "x": 10400,
                "y": 10200,
                "z": 0
              },
              "componentGroupName": "document-processing",
              "customNodeConfig": {
                "name": "DOC-to-Chunks",
                "to_correct_spelling": false,
                "ocr_from_images": false,
                "ocr_integration_method": "append_to_page",
                "use_markdown_extraction": false,
                "chunking_strategy": "recursive",
                "max_chunk_size": 300,
                "chunk_overlap": 40,
                "validation": {
                  "valid": true,
                  "errors": []
                }
              },
              "repeatable": true,
              "pipelineNodeName": "doc-processor-node",
              "variableDataset": "chunks-dataset"
            }
          },
          {
            "id": "f370269c-6d96-4184-bed4-e2076d199ba9",
            "inputs": [
              {
                "portId": "518f648f-03b2-45db-b32e-a2a800910a35",
                "nodeId": "518f648f-03b2-45db-b32e-a2a800910a35",
                "type": "Item",
                "name": "item",
                "displayName": "item",
                "io": "input"
              }
            ],
            "outputs": [
              {
                "portId": "c7de0498-6ec8-4521-90ec-118d8eab5684",
                "nodeId": "c7de0498-6ec8-4521-90ec-118d8eab5684",
                "type": "Item",
                "name": "item",
                "displayName": "item",
                "io": "output"
              }
            ],
            "name": "Chunk to Prompt",
            "type": "custom",
            "namespace": {
              "functionName": "chunk_to_prompt",
              "serviceName": "context-v2-service",
              "moduleName": "context-v2-module",
              "packageName": "contextual_chunks"
            },
            "appName": "Contextual Chunks Generator",
            "dpkName": "contextual_chunks",
            "metadata": {
              "position": {
                "x": 10800,
                "y": 10100,
                "z": 0
              },
              "componentGroupName": "text-utils",
              "customNodeConfig": {
                "name": "Chunk-to-Prompt",
                "remote_path": "/chunks_prompts",
                "validation": {
                  "valid": true,
                  "errors": []
                }
              },
              "repeatable": true,
              "pipelineNodeName": "chunk_to_prompt"
            }
          },
          {
            "id": "ca798460-2a67-4941-94cd-12339f8ad6dc",
            "inputs": [
              {
                "portId": "f1562bf1-a284-48fa-a78e-f1b294958796",
                "nodeId": "f1562bf1-a284-48fa-a78e-f1b294958796",
                "type": "Item",
                "name": "item",
                "displayName": "item",
                "io": "input"
              }
            ],
            "outputs": [
              {
                "portId": "90c3d813-46a3-4505-a87f-ce0e0b70a3dc",
                "nodeId": "90c3d813-46a3-4505-a87f-ce0e0b70a3dc",
                "type": "Item",
                "name": "item",
                "displayName": "item",
                "io": "output"
              },
              {
                "portId": "9f955270-89f1-47b4-a592-c3cbc54b50c4",
                "nodeId": "9f955270-89f1-47b4-a592-c3cbc54b50c4",
                "type": "Annotation[]",
                "name": "annotations",
                "displayName": "annotations",
                "io": "output"
              }
            ],
            "name": "Generate",
            "type": "ml",
            "namespace": {
              "functionName": "predict",
              "serviceName": "model-mgmt-app-predict",
              "moduleName": "model-mgmt-app-predict",
              "packageName": "model-mgmt-app"
            },
            "metadata": {
              "position": {
                "x": 11200,
                "y": 10100,
                "z": 0
              },
              "modelConfig": {},
              "componentGroupName": "models",
              "repeatable": true,
              "mlType": "genAi"
            }
          },
          {
            "id": "ac1b5142-b5a8-497f-9aa0-1112e0c45cbb",
            "inputs": [
              {
                "portId": "4d0347f2-af14-4af8-857c-d508b4032dfd",
                "nodeId": "4d0347f2-af14-4af8-857c-d508b4032dfd",
                "type": "Item",
                "name": "item",
                "displayName": "item",
                "io": "input"
              },
              {
                "portId": "29396445-1a02-48b7-801d-0af379189a74",
                "nodeId": "29396445-1a02-48b7-801d-0af379189a74",
                "type": "Model",
                "name": "model",
                "displayName": "model",
                "io": "input",
                "variableName": "model",
                "description": "The Model used to generate the context."
              }
            ],
            "outputs": [
              {
                "portId": "29e8c5d4-9ac1-4c51-8aba-f6cf44058b40",
                "nodeId": "29e8c5d4-9ac1-4c51-8aba-f6cf44058b40",
                "type": "Item",
                "name": "item",
                "displayName": "item",
                "io": "output"
              }
            ],
            "name": "Add Context to Chunk",
            "type": "custom",
            "namespace": {
              "functionName": "add_response_to_chunk",
              "serviceName": "context-v2-service",
              "moduleName": "context-v2-module",
              "packageName": "contextual_chunks"
            },
            "appName": "Contextual Chunks Generator",
            "dpkName": "contextual_chunks",
            "metadata": {
              "position": {
                "x": 11600,
                "y": 10100,
                "z": 0
              },
              "componentGroupName": "text-utils",
              "customNodeConfig": {
                "name": "Context-to-Chunk",
                "overwrite_chunk": false,
                "remote_path": "/contextual_chunks",
                "validation": {
                  "valid": true,
                  "errors": []
                }
              },
              "repeatable": true,
              "pipelineNodeName": "add_response_to_chunk"
            }
          },
          {
            "id": "65f014b4-e9be-4960-b9c4-d31e34eab1ab",
            "inputs": [
              {
                "portId": "1fdefcab-0514-43d7-aaaf-2e11479baeb0",
                "nodeId": "1fdefcab-0514-43d7-aaaf-2e11479baeb0",
                "type": "Item",
                "name": "item",
                "displayName": "item",
                "io": "input"
              }
            ],
            "outputs": [
              {
                "portId": "0cdf7b9a-540b-42fc-96bd-7d98374c16b4",
                "nodeId": "0cdf7b9a-540b-42fc-96bd-7d98374c16b4",
                "type": "Item",
                "name": "item",
                "displayName": "item",
                "io": "output"
              }
            ],
            "name": "Chunks Dataset",
            "type": "storage",
            "namespace": {
              "functionName": "clone_item",
              "projectName": "DataloopTasks",
              "serviceName": "pipeline-utils",
              "moduleName": "default_module",
              "packageName": "pipeline-utils"
            },
            "metadata": {
              "position": {
                "x": 12000,
                "y": 10100,
                "z": 0
              },
              "componentGroupName": "data",
              "repeatable": true,
              "variableDataset": "chunks-dataset"
            }
          },
          {
            "id": "5eecc3b1-ebf6-4a92-9638-239e1a8bd5e8",
            "inputs": [
              {
                "portId": "afae18c7-763c-464b-a541-13365e471fc5",
                "nodeId": "afae18c7-763c-464b-a541-13365e471fc5",
                "type": "Item",
                "name": "item",
                "displayName": "item",
                "io": "input"
              }
            ],
            "outputs": [
              {
                "portId": "34443c4c-acfb-4d17-b0b4-8babf8a4110e",
                "nodeId": "34443c4c-acfb-4d17-b0b4-8babf8a4110e",
                "type": "Item",
                "name": "item",
                "displayName": "item",
                "io": "output"
              },
              {
                "portId": "d26a67c5-a714-4118-8396-bfc2de402a16",
                "nodeId": "d26a67c5-a714-4118-8396-bfc2de402a16",
                "type": "Json",
                "name": "json",
                "displayName": "json",
                "io": "output"
              }
            ],
            "name": "Embeddings",
            "type": "ml",
            "namespace": {
              "functionName": "embed",
              "serviceName": "model-mgmt-app-embeddings",
              "moduleName": "model-mgmt-app-embeddings",
              "packageName": "model-mgmt-app"
            },
            "metadata": {
              "position": {
                "x": 12400,
                "y": 10100,
                "z": 0
              },
              "modelConfig": {},
              "componentGroupName": "models",
              "repeatable": true,
              "mlType": "embeddings"
            }
          }
        ],
        "connections": [
          {
            "src": {
              "nodeId": "a8ce4ea4-325d-4df9-aed9-86b91b672126",
              "portId": "1a36ac84-8c3b-4c50-96bc-80f11ece6475"
            },
            "tgt": {
              "nodeId": "b1c2d3e4-1111-4e78-9012-pdf000000002",
              "portId": "b1c2d3e4-2222-4e78-9012-pdf000000002"
            },
            "condition": "{\"metadata.system.mimetype\":\"application/pdf\"}"
          },
          {
            "src": {
              "nodeId": "a8ce4ea4-325d-4df9-aed9-86b91b672126",
              "portId": "1a36ac84-8c3b-4c50-96bc-80f11ece6475"
            },
            "tgt": {
              "nodeId": "b1c2d3e4-1111-4e78-9012-doc000000002",
              "portId": "b1c2d3e4-2222-4e78-9012-doc000000002"
            },
            "condition": "{\"metadata.system.mimetype\":\"application/vnd.openxmlformats-officedocument.wordprocessingml.document\"}"
          },
          {
            "src": {
              "nodeId": "b1c2d3e4-1111-4e78-9012-pdf000000002",
              "portId": "b1c2d3e4-4444-4e78-9012-pdf000000002"
            },
            "tgt": {
              "nodeId": "f370269c-6d96-4184-bed4-e2076d199ba9",
              "portId": "518f648f-03b2-45db-b32e-a2a800910a35"
            },
            "condition": "{}"
          },
          {
            "src": {
              "nodeId": "b1c2d3e4-1111-4e78-9012-doc000000002",
              "portId": "b1c2d3e4-4444-4e78-9012-doc000000002"
            },
            "tgt": {
              "nodeId": "f370269c-6d96-4184-bed4-e2076d199ba9",
              "portId": "518f648f-03b2-45db-b32e-a2a800910a35"
            },
            "condition": "{}"
          },
          {
            "src": {
              "nodeId": "f370269c-6d96-4184-bed4-e2076d199ba9",
              "portId": "c7de0498-6ec8-4521-90ec-118d8eab5684"
            },
            "tgt": {
              "nodeId": "ca798460-2a67-4941-94cd-12339f8ad6dc",
              "portId": "f1562bf1-a284-48fa-a78e-f1b294958796"
            },
            "condition": "{}"
          },
          {
            "src": {
              "nodeId": "ca798460-2a67-4941-94cd-12339f8ad6dc",
              "portId": "90c3d813-46a3-4505-a87f-ce0e0b70a3dc"
            },
            "tgt": {
              "nodeId": "ac1b5142-b5a8-497f-9aa0-1112e0c45cbb",
              "portId": "4d0347f2-af14-4af8-857c-d508b4032dfd"
            },
            "condition": "{}"
          },
          {
            "src": {
              "nodeId": "ac1b5142-b5a8-497f-9aa0-1112e0c45cbb",
              "portId": "29e8c5d4-9ac1-4c51-8aba-f6cf44058b40"
            },
            "tgt": {
              "nodeId": "65f014b4-e9be-4960-b9c4-d31e34eab1ab",
              "portId": "1fdefcab-0514-43d7-aaaf-2e11479baeb0"
            },
            "condition": "{}"
          },
          {
            "src": {
              "nodeId": "65f014b4-e9be-4960-b9c4-d31e34eab1ab",
              "portId": "0cdf7b9a-540b-42fc-96bd-7d98374c16b4"
            },
            "tgt": {
              "nodeId": "5eecc3b1-ebf6-4a92-9638-239e1a8bd5e8",
              "portId": "afae18c7-763c-464b-a541-13365e471fc5"
            },
            "condition": "{}"
          }
        ],
        "startNodes": [
          {
            "nodeId": "a8ce4ea4-325d-4df9-aed9-86b91b672126",
            "type": "root",
            "id": "0f587d27-0c80-4827-bff6-173fd9c78ffb"
          }
        ],
        "name": "RAG Contextual Preprocessing",
        "description": "Automate the process of preprocessing source files (Word docs and PDFs) using multimodal document-to-chunks processors with OCR, recursive chunking, contextual enrichment via LLM, and embedding using an Embedder from Marketplace.",
        "preview": "",
        "variables": [
          {
            "name": "chunks-dataset",
            "type": "Dataset",
            "description": "Dataset where text chunks will be stored. Used by both the document-to-chunks processors and the intermediate storage node."
          },
          {
            "name": "model",
            "type": "Model",
            "description": "Generative model that generate the response (context).",
            "value": "$var(model__model)"
          }
        ]
      }
    ]
  },
  "dependencies": [
    {
      "name": "rag-pdf-processor"
    },
    {
      "name": "rag-doc-processor"
    },
    {
      "name": "contextual_chunks"
    }
  ]
}
