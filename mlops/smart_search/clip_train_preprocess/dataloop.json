{
  "name": "clip-preprocess-template",
  "version": "0.1.0",
  "attributes": {
    "Category": "Pipeline",
    "Pipeline Type": "MLOps",
    "Provider": "Dataloop",
    "Media Type": [
      "Image",
      "Text",
      "Multi Modal"
    ]
  },
  "displayName": "CLIP Preprocessing for Fine-tuning",
  "description": "Improve smart image search on your dataset by fine-tuning CLIP",
  "scope": "public",
  "codebase": {
    "type": "git",
    "gitUrl": "https://github.com/dataloop-ai-apps/pipeline-templates.git",
    "gitTag": "1.0.84"
  },
  "components": {
    "pipelineTemplates": [
      {
        "projectId": "0ebbf673-17a7-469c-bcb2-f00fdaedfc8b",
        "orgId": "18739a63-4393-43ea-a87e-9a284b14978f",
        "connections": [
          {
            "src": {
              "nodeId": "609c004b-4cb9-4223-b2dc-89c81a4cfcd5",
              "portId": "e2283762-d599-4468-83ad-c7351d441521"
            },
            "tgt": {
              "nodeId": "c165317d-ae50-4a4c-89b0-2a22a18f2014",
              "portId": "cffa51b6-7ec9-43a6-a32e-73d4ee00b6cf"
            },
            "condition": "{}"
          },
          {
            "src": {
              "nodeId": "d80343ae-a7b3-4039-bc4f-7584978ae9ca",
              "portId": "426907c6-a74d-414d-979f-da2561332772"
            },
            "tgt": {
              "nodeId": "87d920a0-7322-40a5-82d1-cedff95cf2af",
              "portId": "5b0d6847-1a43-4bc1-826f-c182bbe52fda"
            },
            "condition": "{}"
          },
          {
            "src": {
              "nodeId": "87d920a0-7322-40a5-82d1-cedff95cf2af",
              "portId": "5b5361b3-032e-4c47-b67c-ab11e2e4bc8f"
            },
            "tgt": {
              "nodeId": "d7b369df-c864-4ea2-b904-ec4aa0182c47",
              "portId": "294dad1f-20dd-458b-8052-908f55ebd803"
            },
            "condition": "{}"
          }
        ],
        "startNodes": [
          {
            "nodeId": "d80343ae-a7b3-4039-bc4f-7584978ae9ca",
            "type": "root",
            "id": "5d09c1e6-44ba-4066-a14d-02f873a16939"
          }
        ],
        "variables": [
          {
            "id": "6772adc9a985ff6116a0275c",
            "name": "Fine-tuned CLIP",
            "reference": "6772acbe2762fefddba0e21d",
            "creator": "yaya.t@dataloop.ai",
            "type": "Model",
            "description": "Model ID for fine-tuned model entity",
            "createdAt": "2024-12-30T14:27:21.223Z",
            "updatedAt": "2024-12-30T14:35:55.805Z",
            "value": "$var(Fine-tuned CLIP__model)",
            "_id": "6772adc9a985ff6116a0275c"
          },
          {
            "id": "6772ae1736bfb8325c272e72",
            "name": "Dataset with images",
            "reference": "6772acbe2762fefddba0e21d",
            "creator": "yaya.t@dataloop.ai",
            "type": "Dataset",
            "description": "Enter the ID for the dataset with images to search",
            "createdAt": "2024-12-30T14:28:39.837Z",
            "updatedAt": "2024-12-30T14:35:55.805Z",
            "value": "$var(Dataset with images__dataset)",
            "_id": "6772ae1736bfb8325c272e72"
          },
          {
            "id": "6772ae1736bfb84ad0272e73",
            "name": "Pre-trained CLIP",
            "reference": "6772acbe2762fefddba0e21d",
            "creator": "yaya.t@dataloop.ai",
            "type": "Model",
            "description": "Model ID for the pre-trained CLIP model",
            "createdAt": "2024-12-30T14:28:39.837Z",
            "updatedAt": "2024-12-30T14:35:55.805Z",
            "value": "$var(Pre-trained CLIP__model)",
            "_id": "6772ae1736bfb84ad0272e73"
          },
          {
            "id": "6772aee71b00722f9e0f5969",
            "name": "Dataset with prompt items",
            "reference": "6772acbe2762fefddba0e21d",
            "creator": "yaya.t@dataloop.ai",
            "type": "Dataset",
            "description": "Dataset ID for the prepared dataset with prompt items",
            "createdAt": "2024-12-30T14:32:07.626Z",
            "updatedAt": "2024-12-30T14:35:55.805Z",
            "value": "$var(Dataset with prompt items__dataset)",
            "_id": "6772aee71b00722f9e0f5969"
          },
          {
            "id": "6772afcb65c606387ba70198",
            "name": "Train subset filter",
            "reference": "6772acbe2762fefddba0e21d",
            "creator": "yaya.t@dataloop.ai",
            "type": "Json",
            "description": "Model training: Add a DQL filter to extract train subset items from the Ground Truth dataset for training. The default filter will target items marked with the \"train\" metadata tag (\"train\" tag will be added via the \"ML Data Split\" Node).",
            "createdAt": "2024-12-30T14:35:55.806Z",
            "updatedAt": "2024-12-30T15:36:44.638Z",
            "value": {
              "filter": {
                "$and": [
                  {
                    "hidden": false
                  },
                  {
                    "metadata": {
                      "system": {
                        "tags": {
                          "train": true
                        }
                      }
                    }
                  },
                  {
                    "type": "file"
                  }
                ]
              }
            },
            "_id": "6772afcb65c606387ba70198"
          },
          {
            "id": "6772bb1736bfb86820273041",
            "name": "Validation subset filter",
            "reference": "6772acbe2762fefddba0e21d",
            "creator": "yaya.t@dataloop.ai",
            "type": "Json",
            "description": "Model training: Add a DQL filter to extract validation subset items from the Ground Truth dataset for training. The default filter will target items marked with the \"validation\" metadata tag (\"validation\" tag will be added via the \"ML Data Split\" Node).",
            "createdAt": "2024-12-30T15:24:07.927Z",
            "updatedAt": "2024-12-30T15:36:44.638Z",
            "value": {
              "filter": {
                "$and": [
                  {
                    "hidden": false
                  },
                  {
                    "metadata": {
                      "system": {
                        "tags": {
                          "validation": true
                        }
                      }
                    }
                  },
                  {
                    "type": "file"
                  }
                ]
              }
            },
            "_id": "6772bb1736bfb86820273041"
          },
          {
            "id": "6772bb1736bfb8814a273042",
            "name": "Model configuration",
            "reference": "6772acbe2762fefddba0e21d",
            "creator": "yaya.t@dataloop.ai",
            "type": "Json",
            "description": "Configuration for new models creation for both training and prediction. If not provided, the base model's configuration will be used.",
            "createdAt": "2024-12-30T15:24:07.928Z",
            "updatedAt": "2024-12-30T15:36:44.638Z",
            "value": {
              "model_name": "ViT-B/32",
              "embeddings_size": 512,
              "num_epochs": 50,
              "batch_size": 200,
              "learning_rate": 0.0001,
              "early_stopping": true,
              "early_stopping_epochs": 5
            },
            "_id": "6772bb1736bfb8814a273042"
          }
        ],
        "description": "",
        "name": "Clip finetuning pipeline template0",
        "templateKind": "org",
        "nodes": [
          {
            "id": "d80343ae-a7b3-4039-bc4f-7584978ae9ca",
            "inputs": [
              {
                "portId": "3e45feb9-546a-4a33-bcce-a6284efb1cbd",
                "nodeId": "3e45feb9-546a-4a33-bcce-a6284efb1cbd",
                "type": "Model",
                "name": "base_model",
                "displayName": "base_model",
                "variableName": "Pre-trained CLIP",
                "io": "input"
              },
              {
                "portId": "c5df6b94-54ea-4861-a1fb-39c1c325dc05",
                "nodeId": "c5df6b94-54ea-4861-a1fb-39c1c325dc05",
                "type": "Dataset",
                "name": "dataset",
                "displayName": "dataset",
                "variableName": "Dataset with prompt items",
                "io": "input"
              },
              {
                "portId": "d8877d41-90e7-41bd-ad70-2e03cf176706",
                "nodeId": "d8877d41-90e7-41bd-ad70-2e03cf176706",
                "type": "Json",
                "name": "train_subset",
                "displayName": "train_subset",
                "variableName": "Train subset filter",
                "io": "input"
              },
              {
                "portId": "b07ee2d8-38a5-4a5c-a47e-460434804b6d",
                "nodeId": "b07ee2d8-38a5-4a5c-a47e-460434804b6d",
                "type": "Json",
                "name": "validation_subset",
                "displayName": "validation_subset",
                "variableName": "Validation subset filter",
                "io": "input"
              },
              {
                "portId": "30d8b5ac-4d3a-40a3-9cf5-e5b0fa30d892",
                "nodeId": "30d8b5ac-4d3a-40a3-9cf5-e5b0fa30d892",
                "type": "Json",
                "name": "model_configuration",
                "displayName": "model_configuration",
                "variableName": "Model configuration",
                "io": "input"
              }
            ],
            "outputs": [
              {
                "portId": "426907c6-a74d-414d-979f-da2561332772",
                "nodeId": "426907c6-a74d-414d-979f-da2561332772",
                "type": "Model",
                "name": "new_model",
                "displayName": "new_model",
                "io": "output"
              },
              {
                "portId": "747ccc99-a858-4a92-845d-6e11c4116d77",
                "nodeId": "747ccc99-a858-4a92-845d-6e11c4116d77",
                "type": "Model",
                "name": "base_model",
                "displayName": "base_model",
                "io": "output"
              }
            ],
            "name": "Create New Model",
            "type": "custom",
            "namespace": {
              "functionName": "create_new_model",
              "projectName": "Model mgmt demo",
              "serviceName": "create-new-model",
              "moduleName": "create_new_model",
              "packageName": "active-learning"
            },
            "projectId": "0ebbf673-17a7-469c-bcb2-f00fdaedfc8b",
            "appName": "Active Learning",
            "dpkName": "active-learning",
            "metadata": {
              "position": {
                "x": 10108.7412109375,
                "y": 10155.259765625,
                "z": 0
              },
              "serviceConfig": {
                "name": "create-new-model",
                "runtime": {
                  "podType": "regular-xs",
                  "concurrency": 1,
                  "runnerImage": "gcr.io/viewo-g/piper/agent/runner/apps/clip-smart-search:0.1.3",
                  "autoscaler": {
                    "type": "rabbitmq",
                    "minReplicas": 0,
                    "maxReplicas": 2,
                    "queueLength": 100
                  },
                  "preemptible": true
                },
                "initParams": {
                },
                "versions": {
                  "dtlpy": "1.99.12"
                },
                "executionTimeout": 3600,
                "drainTime": 600,
                "onReset": "failed",
                "maxAttempts": 3,
                "botUserName": "bot.05c6603f-ebc3-4608-ab79-57442f8639fa@bot.dataloop.ai",
                "runExecutionAsProcess": false
              },
              "componentGroupName": "models",
              "customNodeConfig": {
                "createModel": "Create New Model",
                "modelName": "{model.name}_{datetime.datetime.now().strftime('%Y_%m_%d-T%H_%M_%S')}",
                "validation": {
                  "valid": true,
                  "errors": [
                  ]
                }
              },
              "repeatable": true,
              "pipelineNodeName": "createNewModel"
            }
          },
          {
            "id": "d7b369df-c864-4ea2-b904-ec4aa0182c47",
            "inputs": [
              {
                "portId": "294dad1f-20dd-458b-8052-908f55ebd803",
                "nodeId": "294dad1f-20dd-458b-8052-908f55ebd803",
                "type": "Model",
                "name": "Fine-tuned CLIP",
                "displayName": "Fine-tuned CLIP",
                "io": "input"
              }
            ],
            "outputs": [
              {
                "portId": "e743d395-0019-4a14-802e-51239631c43e",
                "nodeId": "e743d395-0019-4a14-802e-51239631c43e",
                "type": "Model",
                "name": "Fine-tuned CLIP",
                "displayName": "Fine-tuned CLIP",
                "io": "output"
              }
            ],
            "name": "Update Variable",
            "type": "updateVariable",
            "namespace": {
              "functionName": "update_variable",
              "projectName": "",
              "serviceName": "pipeline-utils",
              "moduleName": "default_module",
              "packageName": "pipeline-utils"
            },
            "projectId": "4eff4f18-5285-42bb-b43d-f74cea633916",
            "metadata": {
              "position": {
                "x": 10732.61765104894,
                "y": 10157.32953745022,
                "z": 0
              },
              "componentGroupName": "data",
              "repeatable": true
            }
          },
          {
            "id": "609c004b-4cb9-4223-b2dc-89c81a4cfcd5",
            "inputs": [
              {
                "portId": "89943e74-cfc7-4559-86b9-bbe1e435f4ca",
                "nodeId": "89943e74-cfc7-4559-86b9-bbe1e435f4ca",
                "type": "Item",
                "name": "item",
                "displayName": "item",
                "io": "input"
              }
            ],
            "outputs": [
              {
                "portId": "e2283762-d599-4468-83ad-c7351d441521",
                "nodeId": "e2283762-d599-4468-83ad-c7351d441521",
                "type": "Item",
                "name": "item",
                "displayName": "item",
                "io": "output"
              }
            ],
            "name": "Dataset with images",
            "type": "storage",
            "namespace": {
              "functionName": "clone_item",
              "projectName": "DataloopTasks",
              "serviceName": "pipeline-utils",
              "moduleName": "default_module",
              "packageName": "pipeline-utils"
            },
            "projectId": "4eff4f18-5285-42bb-b43d-f74cea633916",
            "metadata": {
              "position": {
                "x": 10208.547159167998,
                "y": 10375.838485778231,
                "z": 0
              },
              "componentGroupName": "data",
              "repeatable": true,
              "variableDataset": "Dataset with images"
            }
          },
          {
            "id": "c165317d-ae50-4a4c-89b0-2a22a18f2014",
            "inputs": [
              {
                "portId": "cffa51b6-7ec9-43a6-a32e-73d4ee00b6cf",
                "nodeId": "cffa51b6-7ec9-43a6-a32e-73d4ee00b6cf",
                "type": "Item",
                "name": "item",
                "displayName": "item",
                "io": "input"
              }
            ],
            "outputs": [
              {
                "portId": "a440fdaa-f1f8-4521-b635-c51eee149a6c",
                "nodeId": "a440fdaa-f1f8-4521-b635-c51eee149a6c",
                "type": "Item",
                "name": "item",
                "displayName": "item",
                "io": "output"
              },
              {
                "portId": "cdccf061-ec8a-4046-8a82-397888c5eb41",
                "nodeId": "cdccf061-ec8a-4046-8a82-397888c5eb41",
                "type": "Json",
                "name": "json",
                "displayName": "json",
                "io": "output"
              }
            ],
            "name": "Embeddings",
            "type": "ml",
            "namespace": {
              "functionName": "embed",
              "projectName": "Model mgmt demo",
              "serviceName": "model-mgmt-app-embeddings",
              "moduleName": "model-mgmt-app-embeddings",
              "packageName": "model-mgmt-app"
            },
            "projectId": "0ebbf673-17a7-469c-bcb2-f00fdaedfc8b",
            "metadata": {
              "position": {
                "x": 10559.378741950622,
                "y": 10382.802809812867,
                "z": 0
              },
              "componentGroupName": "models",
              "repeatable": true,
              "mlType": "embeddings"
            }
          },
          {
            "id": "87d920a0-7322-40a5-82d1-cedff95cf2af",
            "inputs": [
              {
                "portId": "5b0d6847-1a43-4bc1-826f-c182bbe52fda",
                "nodeId": "5b0d6847-1a43-4bc1-826f-c182bbe52fda",
                "type": "Model",
                "name": "model",
                "displayName": "model",
                "io": "input"
              }
            ],
            "outputs": [
              {
                "portId": "5b5361b3-032e-4c47-b67c-ab11e2e4bc8f",
                "nodeId": "5b5361b3-032e-4c47-b67c-ab11e2e4bc8f",
                "type": "Model",
                "name": "model",
                "displayName": "model",
                "io": "output"
              }
            ],
            "name": "Train",
            "type": "ml",
            "namespace": {
              "functionName": "train",
              "projectName": "Model mgmt demo",
              "serviceName": "model-mgmt-app-train",
              "moduleName": "model-mgmt-app-train",
              "packageName": "model-mgmt-app"
            },
            "projectId": "0ebbf673-17a7-469c-bcb2-f00fdaedfc8b",
            "metadata": {
              "position": {
                "x": 10414.688812936321,
                "y": 10166.797443667449,
                "z": 0
              },
              "componentGroupName": "models",
              "repeatable": true
            }
          }
        ],
        "preview": "6772be702762fe4dd9a0e654",
        "_id": "6772be8b2762fefd56a0e658"
      }
    ],
    "dependencies": [
      {
        "name": "clip-model-adapter"
      }
    ]
  }